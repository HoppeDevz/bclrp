local a=module('_core','libs/Tunnel')local b=module('_core','libs/Proxy')local c=a.getInterface("hpp_chests")hppC={}a.bindInterface("hpp_chests",hppC)Citizen.CreateThread(function()while true do Citizen.Wait(5*60*1000)collectgarbage("count")collectgarbage("collect")end end)API=b.getInterface('API')cAPI=a.getInterface('cAPI')timeout=200;chestsList={}CurrentChestId=0;CurrentItemsData={}CurrentChestSize=0;RegisterNetEvent("hoppe:build:chests")AddEventHandler("hoppe:build:chests",function()Citizen.Wait(1000)print("hoppe:build:chests")exist_chest_in_list=false;timeout=timeout-1;local d=c.getAllChests()chestsList=d end)function ToogleChestMenu(e,f,g,h)SetNuiFocus(e,e)if e then local i=c.getChestWeight(CurrentChestId)SendNUIMessage({open=e,data=json.decode(f),inv=g,chestSize=h,chestWeight=i})else SendNUIMessage({open=e})end end;RegisterNUICallback("putItem",function(j)local k=c.putInChest(j._item,parseInt(j._amount),CurrentChestId)if k then local l=json.decode(c.getInventoryItems(CurrentChestId))local m=c.getItemWeight(j._item)local n=c.getChestWeight(CurrentChestId)print("chestWeight => "..n)print("itemWeight => "..m)SendNUIMessage({refresh=true,CurrentChestWeight=n})end;if not k then local l=json.decode(c.getInventoryItems(CurrentChestId))ToogleChestMenu(false)ToogleChestMenu(true,CurrentItemsData,l,CurrentChestSize)end end)RegisterNUICallback("remItem",function(j)local k=c.remInChest(j._item,parseInt(j._amount),CurrentChestId)if k then local n=c.getChestWeight(CurrentChestId)local l=json.decode(c.getInventoryItems(CurrentChestId))local m=c.getItemWeight(j._item)SendNUIMessage({refresh=true,CurrentChestWeight=n})end;if not k then local l=json.decode(c.getInventoryItems(CurrentChestId))ToogleChestMenu(false)ToogleChestMenu(true,CurrentItemsData,l,CurrentChestSize)end end)local o=false;RegisterNUICallback("closeMenu",function()ToogleChestMenu(false)CurrentChestId=0;o=false end)Citizen.CreateThread(function()while true do Citizen.Wait(1)if o then else if chestsList then for p,q in pairs(chestsList)do if q then local r=GetPlayerPed(-1)local s,t,u=table.unpack(GetEntityCoords(r))local v=json.decode(q.position)local w,x=GetGroundZFor_3dCoord(v[1],v[2],v[3])local y=GetDistanceBetweenCoords(v[1],v[2],x,s,t,u,true)if y<10 then DrawMarker(20,v[1],v[2],v[3],0,0,0,0,0,0,0.4,0.4,0.4,0,150,150,50,1,1,1,1)DrawText3D(v[1],v[2],v[3]+0.6,"BAÚ",1.0,4,100)if y<1.5 then if IsControlJustPressed(0,38)then TriggerEvent("vrp_sound:source",'zipper',0.05)CurrentChestId=q.id;CurrentItemsData=c.getChestItems(CurrentChestId)CurrentChestSize=q.capacity;local l=json.decode(c.getInventoryItems())ToogleChestMenu(true,CurrentItemsData,l,q.capacity)o=true end end end end end end end end end)Citizen.CreateThread(function()SetNuiFocus(false,false)end)RegisterCommand("vault",function()local z=false;for p,q in pairs(chestsList)do if q then local r=GetPlayerPed(-1)local s,t,u=table.unpack(GetEntityCoords(r))local v=json.decode(q.position)local w,x=GetGroundZFor_3dCoord(v[1],v[2],v[3])local y=GetDistanceBetweenCoords(v[1],v[2],x,s,t,u,true)if y<30 then z=true;if c.checkChestHouseType(q.id)then TriggerEvent("vrp_sound:source",'zipper',0.05)CurrentChestId=q.id;CurrentItemsData=c.getChestItems(CurrentChestId)CurrentChestSize=q.capacity;local l=json.decode(c.getInventoryItems(CurrentChestId))ToogleChestMenu(true,CurrentItemsData,l,q.capacity)o=true;return end end end end;if not z then TriggerEvent("Notify","negado","Nenhum bau perto de você!")end end)function newNotify(A,B,C,D)if B~=-1 then SetNotificationBackgroundColor(B)end;SetNotificationTextEntry(A)for E,F in ipairs(C)do AddTextComponentSubstringPlayerName(F)end;DrawNotification(false,false)if D then PlaySoundFrontend(-1,"Menu_Accept","Phone_SoundSet_Default",1)end end;function notify(G)newNotify("STRING",11,{""..G},true)end;RegisterNetEvent("chest-notify")AddEventHandler("chest-notify",function(G)notify(G)end)function DrawText3D(s,t,u,H,I,J,K)local L,M,N=World3dToScreen2d(s,t,u)local O,P,Q=table.unpack(GetGameplayCamCoords())local R=GetDistanceBetweenCoords(O,P,Q,s,t,u,1)local S=1/R*I;local T=1/GetGameplayCamFov()*100;local S=S*T;if L then SetTextScale(0.0*S,1.1*S)SetTextFont(J)SetTextProportional(1)SetTextColour(255,255,255,K)SetTextDropshadow(0,0,0,0,255)SetTextEdge(2,0,0,0,150)SetTextDropShadow()SetTextOutline()SetTextEntry("STRING")SetTextCentre(1)AddTextComponentString(H)DrawText(M,N)end end