local a=module('_core','libs/Tunnel')local b=module('_core','libs/Proxy')local c=a.getInterface("hpp_carschest")hppC={}a.bindInterface("hpp_carschest",hppC)API=b.getInterface('API')cAPI=a.getInterface('cAPI')local d=""local e=""currentVehicleClass=""VehChestCapacity=0;function getAllVehicles()local f={}local g,h=FindFirstVehicle()if h then table.insert(f,h)end;local i;repeat i,h=FindNextVehicle(g)if i and h then table.insert(f,h)end until not i;EndFindVehicle(g)return f end;function getNearestVehicles(j)local k={}local l,m,n=table.unpack(GetEntityCoords(GetPlayerPed(-1)))for o,h in pairs(getAllVehicles())do local p,q,r=table.unpack(GetEntityCoords(h))local s=GetDistanceBetweenCoords(p,q,r,l,m,n,true)if s<=j then k[h]=s end end;return k end;function getNearestVehicle(j)local h;local f=getNearestVehicles(j)local t=j+0.0001;for u,v in pairs(f)do if v<t then t=v;h=u end end;return h end;function ToogleVehChestMenu(w,x)SetNuiFocus(w,w)if w then local y=c.getInvItems()local z=c.getVehChest(x)TriggerServerEvent("add:veh:chest:in:using",x)SendNUIMessage({open=w,invItems=y,vehChest=z,VehChestCapacity=VehChestCapacity,VehChestWeight=c.getVehChestWeight(d)})else TriggerServerEvent("remove:veh:chest:in:using",d)TriggerServerEvent("trytrunk",e)SendNUIMessage({open=w})end end;RegisterNUICallback("closeMenu",function()ToogleVehChestMenu(false)end)RegisterNetEvent("synctrunk")AddEventHandler("synctrunk",function(A)if NetworkDoesNetworkIdExist(A)then local B=NetToVeh(A)local C=GetVehicleDoorAngleRatio(B,5)if DoesEntityExist(B)then if IsEntityAVehicle(B)then if C==0 then SetVehicleDoorOpen(B,5,0,0)else SetVehicleDoorShut(B,5,0)end end end end end)RegisterNUICallback("putItemInVehChest",function(D)local E=D._item;local F=parseInt(D._amount)if plate~=""then local G=c.putItemInVehChest(E,F,d,VehChestCapacity)if G then SendNUIMessage({refreshWeight=true,newWeight=c.getVehChestWeight(d)})end;if not G then ToogleVehChestMenu(false)ToogleVehChestMenu(true,d)Citizen.Wait(500)TriggerEvent("Notify","negado","Bau cheio!")TriggerServerEvent("trytrunk",VehToNet(e))end end end)RegisterNUICallback("remItemInVehChest",function(D)local E=D._item;local F=parseInt(D._amount)if plate~=""then local G=c.remItemInVehChest(E,F,d)if G then SendNUIMessage({refreshWeight=true,newWeight=c.getVehChestWeight(d)})end;if not G then ToogleVehChestMenu(false)ToogleVehChestMenu(true,d)Citizen.Wait(500)TriggerServerEvent("trytrunk",VehToNet(e))end end end)Citizen.CreateThread(function()while true do Citizen.Wait(1)if IsControlJustPressed(0,208)then local h=getNearestVehicle(4)local plate=GetVehicleNumberPlateText(h)local H=GetVehicleDoorLockStatus(h)if H==1 then if not c.checkChestIsUsing(plate)then if c.getExistPlateInDb(plate)then TriggerServerEvent("trytrunk",VehToNet(h))d=plate;e=VehToNet(h)currentVehicleClass=GetVehicleClass(h)VehChestCapacity=c.getVehicleChestCapacity(d)print('VehChestCapacity',VehChestCapacity)ToogleVehChestMenu(true,plate)end else TriggerEvent("Notify","negado","Alguém já está usando este porta-malas!")end end end end end)function newNotify(I,J,K,L)if J~=-1 then SetNotificationBackgroundColor(J)end;SetNotificationTextEntry(I)for o,M in ipairs(K)do AddTextComponentSubstringPlayerName(M)end;DrawNotification(false,false)if L then PlaySoundFrontend(-1,"Menu_Accept","Phone_SoundSet_Default",1)end end;function notify(N)newNotify("STRING",11,{""..N},true)end;RegisterNetEvent("hoppe:carschest:notify")AddEventHandler("hoppe:carschest:notify",function(O)notify(O)end)