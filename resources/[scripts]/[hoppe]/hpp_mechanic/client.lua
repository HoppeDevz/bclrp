local a=module('_core','libs/Tunnel')local b=module('_core','libs/Proxy')local c=a.getInterface("hpp_mechanic")hppC={}a.bindInterface("hpp_mechanic",hppC)API=b.getInterface('API')cAPI=a.getInterface('cAPI')animApi=module("_core","client/functions/_Anims")Citizen.CreateThread(function()while true do Citizen.Wait(5*60*1000)collectgarbage("count")collectgarbage("collect")end end)RegisterCommand("tirarpm",function()if c.checkPerm("policePerm")then local d=getNearestVehicle(7)SetVehicleDoorBroken(d,5,4,false)TriggerServerEvent("garages-tryUnLock",VehToNet(d))else TriggerEvent("Notify","negado","Você não é um policial!")end end)function ToogleMechanicPc(e)SetNuiFocus(e,e)local f=c.getMechanicStock()if e then SendNUIMessage({open=e,stock=f})else SendNUIMessage({open=e})end end;RegisterNUICallback("addVehTyres",function(g)local h=c.addVehTyresStock(g)if h then TriggerEvent("Notify","sucesso","Pneu adicionado")ToogleMechanicPc(true)else TriggerEvent("Notify","negado","Você não possui pneus!")end end)RegisterNUICallback("addEngine",function(g)local h=c.addEngineStock(g)if h then TriggerEvent("Notify","sucesso","Motor adicionado")ToogleMechanicPc(true)else TriggerEvent("Notify","negado","Você não possui motores!")end end)RegisterNUICallback("closeMenu",function()ToogleMechanicPc(false)end)local i=3000;Citizen.CreateThread(function()while true do Citizen.Wait(i)local j=GetPlayerPed(-1)local k,l,m=table.unpack(GetEntityCoords(j))local n,o=GetGroundZFor_3dCoord(921.21,-985.13,39.49)local p=GetDistanceBetweenCoords(921.21,-985.13,o,k,l,m,true)if p<10 then i=1;DrawMarker(20,921.21,-985.13,39.49,0,0,0,0,0,0,0.5,0.5,0.5,0,150,150,50,1,1,1,1)DrawText3D(921.21,-985.13,39.49+0.6,"COMPUTADOR",1.0,4,100)if p<1.5 then if IsControlJustPressed(0,38)then ToogleMechanicPc(true)end end else i=3000 end end end)local q=3000;local r=false;Citizen.CreateThread(function()while true do Citizen.Wait(q)local j=GetPlayerPed(-1)local k,l,m=table.unpack(GetEntityCoords(j))local n,o=GetGroundZFor_3dCoord(924.89,-985.09,39.49)local p=GetDistanceBetweenCoords(924.89,-985.09,o,k,l,m,true)if p<10 then q=1;DrawMarker(20,924.89,-985.09,39.49,0,0,0,0,0,0,0.5,0.5,0.5,0,150,150,50,1,1,1,1)DrawText3D(924.89,-985.09,39.49+0.6,"MOTOR",1.0,4,100)if p<1.5 then if not r and IsControlJustPressed(0,38)then if c.getEnginesNumber()>0 then animApi.CarregarObjeto("anim@heists@box_carry@","idle","prop_car_battery_01",49,28422)r=true else TriggerEvent("Notify","negado","Sem motores no estoque!")end end end else q=3000 end end end)local s=3000;local t=false;Citizen.CreateThread(function()while true do Citizen.Wait(s)local j=GetPlayerPed(-1)local k,l,m=table.unpack(GetEntityCoords(j))local n,o=GetGroundZFor_3dCoord(928.42,-984.69,39.49)local p=GetDistanceBetweenCoords(928.42,-984.69,o,k,l,m,true)if p<10 then s=1;DrawMarker(20,928.42,-984.69,39.49,0,0,0,0,0,0,0.5,0.5,0.5,0,150,150,50,1,1,1,1)DrawText3D(928.42,-984.69,39.49+0.6,"PNEU",1.0,4,100)if p<1.5 then if not t and IsControlJustPressed(0,38)then if c.getVehTyresNumber()>0 then animApi.CarregarObjeto("anim@heists@box_carry@","idle","prop_rub_tyre_01",49,28422)t=true else TriggerEvent("Notify","negado","Sem pneus no estoque!")end end end else s=3000 end end end)Citizen.CreateThread(function()while true do Citizen.Wait(1)if r or t then if IsControlJustPressed(0,167)then animApi.DeletarObjeto()r=false;t=false end end end end)local u=false;RegisterCommand("fixpneu",function(v,w,x)if c.checkPerm("mechPerm")then if t then local d=getNearestVehicle(7)if w[1]=="ef"then TriggerEvent('cancelando',true)animApi.playAnim(true,{{"amb@medic@standing@tendtodead@idle_a","idle_a"}},true)animApi.DeletarObjeto()t=false;Citizen.Wait(5000)animApi.stopAnim(false)c.removeVehTyres(1)TriggerEvent('cancelando',false)SetVehicleTyreFixed(d,0)TriggerEvent("Notify","importante","Pneu [ESQUERDO TRASEIRO] trocado!")elseif w[1]=="df"then TriggerEvent('cancelando',true)animApi.playAnim(true,{{"amb@medic@standing@tendtodead@idle_a","idle_a"}},true)animApi.DeletarObjeto()t=false;Citizen.Wait(5000)animApi.stopAnim(false)c.removeVehTyres(1)TriggerEvent('cancelando',false)SetVehicleTyreFixed(d,1)TriggerEvent("Notify","importante","Pneu [DIREITO FRONTAL] trocado!")elseif w[1]=="et"then TriggerEvent('cancelando',true)animApi.playAnim(true,{{"amb@medic@standing@tendtodead@idle_a","idle_a"}},true)animApi.DeletarObjeto()t=false;Citizen.Wait(5000)animApi.stopAnim(false)c.removeVehTyres(1)TriggerEvent('cancelando',false)SetVehicleTyreFixed(d,4)TriggerEvent("Notify","importante","Pneu [ESQUERDO TRASEIRO] trocado!")elseif w[1]=="dt"then TriggerEvent('cancelando',true)animApi.playAnim(true,{{"amb@medic@standing@tendtodead@idle_a","idle_a"}},true)animApi.DeletarObjeto()t=false;Citizen.Wait(5000)animApi.stopAnim(false)c.removeVehTyres(1)TriggerEvent('cancelando',false)SetVehicleTyreFixed(d,5)TriggerEvent("Notify","importante","Pneu [DIREITO TRASEIRO] trocado!")end;if u then c.removeItem("vehtyres",1)u=false end else TriggerEvent("Notify","negado","Você precisa de um pneu!")end else TriggerEvent("Notify","negado","Você não é um mecânico!")end end)RegisterCommand("fixmotor",function(v,w,x)if c.checkPerm("mechPerm")then local d=getNearestVehicle(7)local y=GetVehicleDoorAngleRatio(d,4)if y==0 then TriggerEvent("Notify","negado","Você precisa abrir o capô para arruamar o motor!")else if r then TriggerEvent('cancelando',true)animApi.DeletarObjeto()animApi.playAnim(false,{{"mini@repair","fixing_a_ped"}},true)c.removeEngines(1)Citizen.Wait(12000)animApi.stopAnim(false)r=false;TriggerEvent('cancelando',false)SetVehicleEngineHealth(d,1000.0)if u then c.removeItem("vehengine",1)u=false end;TriggerEvent("Notify","sucesso","Motor arrumado com sucesso!")else TriggerEvent("Notify","negado","Você precisa de um motor!")end end else TriggerEvent("Notify","negado","Você não é um mecânico!")end end)RegisterCommand("pegarmotor",function(v,w,x)if r or t then return end;u=true;if c.hasHaveItem("vehengine")then animApi.CarregarObjeto("anim@heists@box_carry@","idle","prop_car_battery_01",49,28422)r=true end end)RegisterCommand("pegarpneu",function(v,w,x)if r or t then return end;u=true;if c.hasHaveItem("vehtyres")then animApi.CarregarObjeto("anim@heists@box_carry@","idle","prop_rub_tyre_01",49,28422)t=true end end)RegisterCommand("fixlataria",function(v,w,x)if c.checkPerm("mechPerm")then local d=getNearestVehicle(7)if GetVehicleEngineHealth(d)>950 then TriggerEvent('cancelando',true)animApi.playAnim(false,{{"mini@repair","fixing_a_ped"}},true)Citizen.Wait(7000)TriggerEvent('cancelando',false)animApi.stopAnim(false)SetVehicleFixed(d)else TriggerEvent("Notify","negado","Arrume o motor primeiro!")end else TriggerEvent("Notify","negado","Você não é um mecânico!")end end)RegisterCommand("hood",function(v,w,x)local d=getNearestVehicle(7)TriggerServerEvent("tryhood",VehToNet(d))end)RegisterCommand("doors",function(v,w,x)if w[1]then local d=getNearestVehicle(7)local z=parseInt(w[1])-1;TriggerServerEvent("trydoors",VehToNet(d),z)end end)RegisterCommand("trunk",function(v,w,x)local d=getNearestVehicle(7)TriggerServerEvent("trytrunk",VehToNet(d))end)RegisterNetEvent("syncdoors")AddEventHandler("syncdoors",function(A,z)if NetworkDoesNetworkIdExist(A)then local B=NetToVeh(A)local y=GetVehicleDoorAngleRatio(B,z)if DoesEntityExist(B)then if IsEntityAVehicle(B)then if y==0 then SetVehicleDoorOpen(B,z,0,0)else SetVehicleDoorShut(B,z,0)end end end end end)RegisterNetEvent("synctrunk")AddEventHandler("synctrunk",function(A)if NetworkDoesNetworkIdExist(A)then local B=NetToVeh(A)local y=GetVehicleDoorAngleRatio(B,5)if DoesEntityExist(B)then if IsEntityAVehicle(B)then if y==0 then SetVehicleDoorOpen(B,5,0,0)else SetVehicleDoorShut(B,5,0)end end end end end)RegisterNetEvent("synchood")AddEventHandler("synchood",function(A)if NetworkDoesNetworkIdExist(A)then local B=NetToVeh(A)local y=GetVehicleDoorAngleRatio(B,4)if DoesEntityExist(B)then if IsEntityAVehicle(B)then if y==0 then SetVehicleDoorOpen(B,4,0,0)else SetVehicleDoorShut(B,4,0)end end end end end)function getAllVehicles()local C={}local D,d=FindFirstVehicle()if d then table.insert(C,d)end;local E;repeat E,d=FindNextVehicle(D)if E and d then table.insert(C,d)end until not E;EndFindVehicle(D)return C end;function getNearestVehicles(F)local G={}local H,I,J=table.unpack(GetEntityCoords(GetPlayerPed(-1)))for K,d in pairs(getAllVehicles())do local k,l,m=table.unpack(GetEntityCoords(d))local p=GetDistanceBetweenCoords(k,l,m,H,I,J,true)if p<=F then G[d]=p end end;return G end;function getNearestVehicle(F)local d;local C=getNearestVehicles(F)local L=F+0.0001;for M,N in pairs(C)do if N<L then L=N;d=M end end;return d end;function newNotify(O,P,Q,R)if P~=-1 then SetNotificationBackgroundColor(P)end;SetNotificationTextEntry(O)for K,S in ipairs(Q)do AddTextComponentSubstringPlayerName(S)end;DrawNotification(false,false)if R then PlaySoundFrontend(-1,"Menu_Accept","Phone_SoundSet_Default",1)end end;function notify(T)newNotify("STRING",11,{""..T},true)end;function DrawText3D(k,l,m,U,V,W,X)local Y,Z,_=World3dToScreen2d(k,l,m)local H,I,J=table.unpack(GetGameplayCamCoords())local N=GetDistanceBetweenCoords(H,I,J,k,l,m,1)local a0=1/N*V;local a1=1/GetGameplayCamFov()*100;local a0=a0*a1;if Y then SetTextScale(0.0*a0,1.1*a0)SetTextFont(W)SetTextProportional(1)SetTextColour(255,255,255,X)SetTextDropshadow(0,0,0,0,255)SetTextEdge(2,0,0,0,150)SetTextDropShadow()SetTextOutline()SetTextEntry("STRING")SetTextCentre(1)AddTextComponentString(U)DrawText(Z,_)end end