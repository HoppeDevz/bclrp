local a=module('_core','libs/Tunnel')local b=module('_core','libs/Proxy')local c=a.getInterface("hpp_racing")API=b.getInterface('API')cAPI=a.getInterface('cAPI')hppC={}a.bindInterface("hpp_racing",hppC)cfg=module("hpp_racing","config/spots")Citizen.CreateThread(function()while true do Citizen.Wait(5*60*1000)collectgarbage("count")collectgarbage("collect")end end)local d=false;local e=0;local f=0;local g=0;local h;local i=0;function ToogleRunScoreBoard(j,k)local l=c.getScoreBoard(k)SendNUIMessage({open=j,runId=k,scoreboard=l})end;Citizen.CreateThread(function()for m,n in pairs(cfg.runs)do local o=AddBlipForCoord(n.start_race[1],n.start_race[2],n.start_race[3])SetBlipSprite(o,38)SetBlipColour(o,1)SetBlipScale(o,0.7)SetBlipAsShortRange(o,true)BeginTextCommandSetBlipName("STRING")AddTextComponentString("Corrida")EndTextCommandSetBlipName(o)end end)local p=3000;local q=false;Citizen.CreateThread(function()while true do Citizen.Wait(p)for m,n in pairs(cfg.runs)do if m==1 then q=false end;local r=GetPlayerPed(-1)local s,t,u=table.unpack(GetEntityCoords(r))local v,w,x=n.start_race[1],n.start_race[2],n.start_race[3]local y,z=GetGroundZFor_3dCoord(v,w,x)local A=GetDistanceBetweenCoords(v,w,z,s,t,u,true)if not d and A<20 then q=true;DrawMarker(4,v,w,x,0,0,0,0,0,0,1.0,1.0,1.0,51,255,255,50,1,1,1,1)DrawMarker(1,v,w,x-1,0,0,0,0,0,0,2.0,2.0,2.0,51,255,255,50,0,0,0,0)DrawText3D(v,w,x+0.8,"CORRIDA",3.0,7,100)if A<2 then drawTxt("PRESSIONE ~b~E ~w~PARA COMEÇAR A CORRIDA",4,0.50,0.95,0.36,255,255,255,240)end;if A<1.5 then if IsControlJustPressed(0,38)then if IsPedInAnyVehicle(r)then local B=GetVehiclePedIsIn(GetPlayerPed(-1))local C=GetVehicleClass(B)if C==8 then TriggerEvent("Notify","negado","Você não pode correr de moto!")else ToogleRunScoreBoard(true,m)d=true;e=m;f=1;for D in pairs(cfg.runs[e].racing_line)do g=g+1 end;h=AddBlipForCoord(cfg.runs[e].racing_line[f][1],cfg.runs[e].racing_line[f][2],cfg.runs[e].racing_line[f][3])SetBlipSprite(h,1)SetBlipColour(h,4)SetBlipScale(h,1.5)SetBlipAsShortRange(h,false)BeginTextCommandSetBlipName("STRING")AddTextComponentString("Corrida")ShowNumberOnBlip(h,f)EndTextCommandSetBlipName(h)end else TriggerEvent("Notify","negado","VOCÊ PRECISA ESTAR DENTRO DE UM CARRO!")end end end end end;if q then p=1 else p=3000 end end end)Citizen.CreateThread(function()while true do if d then i=i+1 end;Citizen.Wait(1000)end end)Citizen.CreateThread(function()while true do Citizen.Wait(p)if d then if i<10 then drawTxt("TEMPO: ~r~0"..i.."s",4,0.50,0.95,0.36,255,255,255,240)else drawTxt("TEMPO: ~r~"..i.."s",4,0.50,0.95,0.36,255,255,255,240)end end end end)Citizen.CreateThread(function()while true do Citizen.Wait(1)if d then local r=GetPlayerPed(-1)local s,t,u=table.unpack(GetEntityCoords(r))local v,w,x=cfg.runs[e].racing_line[f][1],cfg.runs[e].racing_line[f][2],cfg.runs[e].racing_line[f][3]local y,z=GetGroundZFor_3dCoord(v,w,x)local A=GetDistanceBetweenCoords(v,w,z,s,t,u,true)DrawMarker(36,v,w,x,0,0,0,0,0,0,1.0,1.0,1.0,255,150,255,50,1,1,1,1)if A<10 then if g==f then c.saveRunTime(e,i)d=false;e=0;f=0;g=0;RemoveBlip(h)SendNUIMessage({open=false})local E=c.getAward()TriggerEvent("Notify","sucesso","VOCÊ COMPLETOU A CORRIDA E GANHOU R$"..E.."!")i=0 else f=f+1;local v,w,x=cfg.runs[e].racing_line[f][1],cfg.runs[e].racing_line[f][2],cfg.runs[e].racing_line[f][3]SetBlipCoords(h,v,w,x)ShowNumberOnBlip(h,f)if f==g then SetBlipColour(h,2)end end end end end end)function drawTxt(F,G,s,t,H,I,J,K,L)SetTextFont(G)SetTextScale(H,H)SetTextColour(I,J,K,L)SetTextOutline()SetTextCentre(1)SetTextEntry("STRING")AddTextComponentString(F)DrawText(s,t)end;function newNotify(M,N,O,P)if N~=-1 then SetNotificationBackgroundColor(N)end;SetNotificationTextEntry(M)for D,Q in ipairs(O)do AddTextComponentSubstringPlayerName(Q)end;DrawNotification(false,false)if P then PlaySoundFrontend(-1,"Menu_Accept","Phone_SoundSet_Default",1)end end;function notify(R)newNotify("STRING",11,{""..R},true)end;function DrawText3D(s,t,u,F,S,G,T)local U,V,W=World3dToScreen2d(s,t,u)local X,Y,Z=table.unpack(GetGameplayCamCoords())local _=GetDistanceBetweenCoords(X,Y,Z,s,t,u,1)local H=1/_*S;local a0=1/GetGameplayCamFov()*100;local H=H*a0;if U then SetTextScale(0.0*H,1.1*H)SetTextFont(G)SetTextProportional(1)SetTextColour(255,255,255,T)SetTextDropshadow(0,0,0,0,255)SetTextEdge(2,0,0,0,150)SetTextDropShadow()SetTextOutline()SetTextEntry("STRING")SetTextCentre(1)AddTextComponentString(F)DrawText(V,W)end end