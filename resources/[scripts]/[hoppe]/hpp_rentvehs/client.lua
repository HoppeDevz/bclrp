local a=module('_core','libs/Tunnel')local b=module('_core','libs/Proxy')local c=a.getInterface("hpp_rentvehs")API=b.getInterface('API')cAPI=a.getInterface('cAPI')local d=module("hpp_rentvehs","config/rentvehs")animApi=module("_core","client/functions/_Anims")Citizen.CreateThread(function()while true do Citizen.Wait(5*60*1000)collectgarbage("count")collectgarbage("collect")end end)local e;local f=""local g=""Citizen.CreateThread(function()while true do Citizen.Wait(1)if f~=""then if DoesEntityExist(f)then else f=""g=""end end end end)function ToogleRentVehsMenu(h,i,j)if h then PlaySoundFrontend(-1,"TOGGLE_ON","HUD_FRONTEND_DEFAULT_SOUNDSET",1)end;SetNuiFocus(h,h)if h then SendNUIMessage({open=h,data=i,headerImg=j})else SendNUIMessage({open=h})end end;RegisterNUICallback("spawnCar",function(k)PlaySoundFrontend(-1,"MP_AWARD","HUD_FRONTEND_DEFAULT_SOUNDSET",1)if f==""then hpp_spawnCar(k,"ALUGUEL",e[1],e[2],e[3],e[4])TriggerEvent("Notify","sucesso","Veículo retirado com sucesso!")else TriggerEvent("Notify","negado","Você já tem um veículo fora da garagem!")end end)RegisterNUICallback("storeCar",function()PlaySoundFrontend(-1,"NO","HUD_FRONTEND_DEFAULT_SOUNDSET",1)DeleteEntity(f)f=""end)RegisterNUICallback("closeMenu",function()PlaySoundFrontend(-1,"QUIT","HUD_FRONTEND_DEFAULT_SOUNDSET",1)ToogleRentVehsMenu(false)end)local l={}Citizen.CreateThread(function()while true do Citizen.Wait(3000)for m,n in pairs(d.rentgarages)do local o=GetPlayerPed(-1)local p,q,r=table.unpack(GetEntityCoords(o))local s,t=GetGroundZFor_3dCoord(n._config.coords.x,n._config.coords.y,n._config.coords.z)local u=GetDistanceBetweenCoords(n._config.coords.x,n._config.coords.y,t,p,q,r,true)if u<20 then if#l>0 then for v,w in pairs(l)do if w[1]==n._config.coords.x then else table.insert(l,1,{n._config.coords.x,n._config.coords.y,n._config.coords.z,n._config.text3d,n._config.perm,n.vehicles,n._config.headerImg,n._config.spawnloc.x,n._config.spawnloc.y,n._config.spawnloc.z,n._config.spawnloc.h})end end else table.insert(l,1,{n._config.coords.x,n._config.coords.y,n._config.coords.z,n._config.text3d,n._config.perm,n.vehicles,n._config.headerImg,n._config.spawnloc.x,n._config.spawnloc.y,n._config.spawnloc.z,n._config.spawnloc.h})end end end end end)local x=3000;Citizen.CreateThread(function()while true do if#l>0 then x=1;for m,n in pairs(l)do local o=GetPlayerPed(-1)local y,z,A=n[1],n[2],n[3]local B,C,D=table.unpack(GetEntityCoords(o))local u=GetDistanceBetweenCoords(y,z,A,B,C,D,true)if u<10 then DrawMarker(20,y,z,A,0,0,0,0,0,0,1.0,1.0,1.0,0,150,150,50,1,1,1,1)DrawText3D(y,z,A+0.6,n[4],1.0,4,100)if u<1.5 then if IsControlJustPressed(0,38)then if n[5]then if c.checkPerm(n[5])then ToogleRentVehsMenu(true,n[6],n[7])e={n[8],n[9],n[10],n[11]}else TriggerEvent("Notify","negado","Você não tem permissão!")end else ToogleRentVehsMenu(true,n[6],n[7])e={n[8],n[9],n[10],n[11]}end end end else l={}end end end;Citizen.Wait(x)end end)function hpp_spawnCar(E,F,p,q,r,G)local H=GetHashKey(E)while not HasModelLoaded(H)do RequestModel(H)Citizen.Wait(1)end;if HasModelLoaded(H)then local I=CreateVehicle(H,p,q,r+0.5,G,true,false)local J=VehToNet(I)local K=NetworkGetNetworkIdFromEntity(I)NetworkRegisterEntityAsNetworked(I)while not NetworkGetEntityIsNetworked(I)do NetworkRegisterEntityAsNetworked(I)Citizen.Wait(1)end;if NetworkDoesNetworkIdExist(J)then SetEntitySomething(I,true)if NetworkGetEntityIsNetworked(I)then SetNetworkIdExistsOnAllMachines(J,true)end end;SetNetworkIdCanMigrate(K,true)SetVehicleNumberPlateText(NetToVeh(J),F)Citizen.InvokeNative(0xAD738C3085FE7E11,NetToVeh(J),true,true)SetVehicleHasBeenOwnedByPlayer(NetToVeh(J),true)SetVehicleNeedsToBeHotwired(NetToVeh(J),false)SetModelAsNoLongerNeeded(H)SetVehRadioStation(NetToVeh(J),"OFF")f=I;return I end end;function newNotify(L,M,N,O)if M~=-1 then SetNotificationBackgroundColor(M)end;SetNotificationTextEntry(L)for P,Q in ipairs(N)do AddTextComponentSubstringPlayerName(Q)end;DrawNotification(false,false)if O then PlaySoundFrontend(-1,"Menu_Accept","Phone_SoundSet_Default",1)end end;function notify(R)newNotify("STRING",11,{""..R},true)end;function DrawText3D(p,q,r,S,T,U,V)local W,X,Y=World3dToScreen2d(p,q,r)local Z,_,a0=table.unpack(GetGameplayCamCoords())local a1=GetDistanceBetweenCoords(Z,_,a0,p,q,r,1)local a2=1/a1*T;local a3=1/GetGameplayCamFov()*100;local a2=a2*a3;if W then SetTextScale(0.0*a2,1.1*a2)SetTextFont(U)SetTextProportional(1)SetTextColour(255,255,255,V)SetTextDropshadow(0,0,0,0,255)SetTextEdge(2,0,0,0,150)SetTextDropShadow()SetTextOutline()SetTextEntry("STRING")SetTextCentre(1)AddTextComponentString(S)DrawText(X,Y)end end;Citizen.CreateThread(function()while true do Citizen.Wait(1)if IsControlJustPressed(0,182)then if f~=""then animApi.playAnim(true,{{"anim@mp_player_intmenu@key_fob@","fob_click_fp"}},false)TriggerServerEvent("rentvehs-tryLock",VehToNet(f))local a4=GetVehicleDoorLockStatus(f)if a4==1 then TriggerEvent("Notify","importante","Veículo trancado!")else TriggerEvent("Notify","importante","Veículo destrancado!")end;TriggerEvent("vrp_sound:source",'lock',0.5)end end end end)RegisterNetEvent("rentvehs-syncLock")AddEventHandler("rentvehs-syncLock",function(a5)if NetworkDoesNetworkIdExist(a5)then local n=NetToVeh(a5)if DoesEntityExist(n)then if IsEntityAVehicle(n)then local a4=GetVehicleDoorLockStatus(n)if a4==1 then SetVehicleDoorsLocked(n,2)else SetVehicleDoorsLocked(n,1)end;SetVehicleLights(n,2)Wait(200)SetVehicleLights(n,0)Wait(200)SetVehicleLights(n,2)Wait(200)SetVehicleLights(n,0)end end end end)