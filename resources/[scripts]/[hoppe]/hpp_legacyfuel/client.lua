local a=false;local b=false;local c=0.0;local d=0.0;local e=0.0;function ManageFuelUsage(f)if IsVehicleEngineOn(f)then SetVehicleFuelLevel(f,GetVehicleFuelLevel(f)-Config.FuelUsage[Round(GetVehicleCurrentRpm(f),1)]*(Config.Classes[GetVehicleClass(f)]or 1.0)/10)DecorSetFloat(f,Config.FuelDecor,GetVehicleFuelLevel(f))end end;Citizen.CreateThread(function()while true do Citizen.Wait(5*60*1000)collectgarbage("count")collectgarbage("collect")end end)Citizen.CreateThread(function()DecorRegister(Config.FuelDecor,1)while true do Citizen.Wait(1000)local g=PlayerPedId()if IsPedInAnyVehicle(g)then local f=GetVehiclePedIsIn(g)if GetPedInVehicleSeat(f,-1)==g then ManageFuelUsage(f)end end end end)function FindNearestFuelPump()local h=GetEntityCoords(PlayerPedId())local i={}local j,k=FindFirstObject()local l;repeat if Config.PumpModels[GetEntityModel(k)]then table.insert(i,k)end;l,k=FindNextObject(j,k)until not l;EndFindObject(j)local m=0;local n=1000;for o,p in pairs(i)do local q=GetDistanceBetweenCoords(h,GetEntityCoords(p))if q<n then n=q;m=p end end;return m,n end;Citizen.CreateThread(function()while true do Citizen.Wait(250)local m,n=FindNearestFuelPump()if n<2.5 then a=m else a=false;Citizen.Wait(math.ceil(n*20))end end end)AddEventHandler('fuel:startFuelUpTick',function(m,g,f)c=GetVehicleFuelLevel(f)d=GetVehicleFuelLevel(f)while b do Citizen.Wait(100)local r=DecorGetFloat(f,Config.FuelDecor)local s=math.random(10,20)/100.0;local t=s/0.2;if not m then if GetAmmoInPedWeapon(g,883325847)-s*100>=0 then c=r+s;SetPedAmmo(g,883325847,math.floor(GetAmmoInPedWeapon(g,883325847)-s*100))else b=false end else c=r+s end;if c>100.0 then c=100.0;b=false end;e=e+t;SetVehicleFuelLevel(f,c)DecorSetFloat(f,Config.FuelDecor,GetVehicleFuelLevel(f))end;if m then TriggerServerEvent('vrp_legacyfuel:pagamento2020',parseInt(e))end;e=0.0 end)RegisterNetEvent('vrp_legacyfuel:insuficiente2020')AddEventHandler('vrp_legacyfuel:insuficiente2020',function()local f=GetPlayersLastVehicle()if f then SetVehicleFuelLevel(f,d)DecorSetFloat(f,Config.FuelDecor,GetVehicleFuelLevel(f))end end)RegisterNetEvent('vrp_legacyfuel:galao2020')AddEventHandler('vrp_legacyfuel:galao2020',function()end)function Round(u,v)local w=10^(v or 0)return math.floor(u*w+0.5)/w end;AddEventHandler('fuel:refuelFromPump',function(m,g,f)TaskTurnPedToFaceEntity(g,f,5000)LoadAnimDict("timetable@gardener@filling_can")TaskPlayAnim(g,"timetable@gardener@filling_can","gar_ig_5_filling_can",2.0,8.0,-1,50,0,0,0,0)TriggerEvent('fuel:startFuelUpTick',m,g,f)while b do Citizen.Wait(1)for o,p in pairs(Config.DisableKeys)do DisableControlAction(0,p)end;local x=GetEntityCoords(f)if m then local y=GetEntityCoords(m)DrawText3Ds(y.x,y.y,y.z+1.2,"PRESSIONE ~g~E ~w~PARA CANCELAR")DrawText3Ds(x.x,x.y,x.z+0.5,"TANQUE: ~y~"..Round(c,1).."%")else DrawText3Ds(x.x,x.y,x.z+0.5,"PRESSIONE ~g~E ~w~PARA CANCELAR")DrawText3Ds(x.x,x.y,x.z+0.34,"GALÃO: ~b~"..Round(GetAmmoInPedWeapon(g,883325847)/4500*100,1).."%~w~    TANQUE: ~y~"..Round(c,1).."%")end;if not IsEntityPlayingAnim(g,"timetable@gardener@filling_can","gar_ig_5_filling_can",3)then TaskPlayAnim(g,"timetable@gardener@filling_can","gar_ig_5_filling_can",2.0,8.0,-1,50,0,0,0,0)end;if IsControlJustReleased(0,38)or DoesEntityExist(GetPedInVehicleSeat(f,-1))or a and GetEntityHealth(m)<=0 then b=false end end;ClearPedTasks(g)RemoveAnimDict("timetable@gardener@filling_can")end)Citizen.CreateThread(function()while true do Citizen.Wait(1)local g=PlayerPedId()if not b and(a and GetEntityHealth(a)>0 or GetSelectedPedWeapon(g)==883325847 and not a)then if IsPedInAnyVehicle(g)and GetPedInVehicleSeat(GetVehiclePedIsIn(g),-1)==g then local z=GetEntityCoords(a)DrawText3Ds(z.x,z.y,z.z+1.2,"SAIA DO ~y~VEÍCULO ~w~PARA ABASTECER")else local f=GetPlayersLastVehicle()local x=GetEntityCoords(f)if DoesEntityExist(f)and GetDistanceBetweenCoords(GetEntityCoords(g),x)<2.5 then if not DoesEntityExist(GetPedInVehicleSeat(f,-1))then local y=GetEntityCoords(a)local A=true;if GetSelectedPedWeapon(g)==883325847 then y=x;if GetAmmoInPedWeapon(g,883325847)<100 then A=false end end;if GetVehicleFuelLevel(f)<99 and A then DrawText3Ds(y.x,y.y,y.z+1.2,"PRESSIONE ~g~E ~w~PARA ABASTECER")if IsControlJustReleased(0,38)then b=true;TriggerEvent('fuel:refuelFromPump',a,g,f)LoadAnimDict("timetable@gardener@filling_can")end elseif not A then DrawText3Ds(y.x,y.y,y.z+1.2,"~o~GALÃO VAZIO")else DrawText3Ds(y.x,y.y,y.z+1.2,"~g~TANQUE CHEIO")end end elseif a then local y=GetEntityCoords(a)DrawText3Ds(y.x,y.y,y.z+1.2,"PRESSIONE ~g~E ~w~PARA COMPRAR UM ~b~GALÃO DE GASOLINA")if IsControlJustReleased(0,38)then TriggerServerEvent('vrp_legacyfuel:pagamento2020',parseInt(300),true)end else Citizen.Wait(250)end end else Citizen.Wait(250)end end end)function DrawText3Ds(B,C,D,E)local F,G,H=World3dToScreen2d(B,C,D)SetTextFont(4)SetTextScale(0.35,0.35)SetTextColour(255,255,255,150)SetTextEntry("STRING")SetTextCentre(1)AddTextComponentString(E)DrawText(G,H)local I=string.len(E)/370;DrawRect(G,H+0.0125,0.01+I,0.03,0,0,0,80)end;function LoadAnimDict(J)if not HasAnimDictLoaded(J)then RequestAnimDict(J)while not HasAnimDictLoaded(J)do Citizen.Wait(10)end end end