local a=module('_core','libs/Tunnel')local b=module('_core','libs/Proxy')local c=a.getInterface("hpp_craft")API=b.getInterface('API')cAPI=a.getInterface('cAPI')hppC={}a.bindInterface("hpp_craft",hppC)Citizen.CreateThread(function()while true do Citizen.Wait(5*60*1000)collectgarbage("count")collectgarbage("collect")end end)local d=module("hpp_craft","config/cfg")local e=false;animApi=module("_core","client/functions/_Anims")Citizen.CreateThread(function()for f,g in pairs(d.blips)do local h=AddBlipForCoord(g.coords[1],g.coords[2],g.coords[3])SetBlipSprite(h,g.sprite)SetBlipColour(h,g.color)SetBlipScale(h,0.6)SetBlipAsShortRange(h,true)BeginTextCommandSetBlipName("STRING")AddTextComponentString(g.title)EndTextCommandSetBlipName(h)end end)local i=3000;local j=false;Citizen.CreateThread(function()while true do Citizen.Wait(i)for k,l in pairs(d.crafts)do if k==1 then j=false end;local m=GetPlayerPed(-1)local n,o,p=table.unpack(GetEntityCoords(m))local q,r=GetGroundZFor_3dCoord(l.coords[1],l.coords[2],l.coords[3])local s=GetDistanceBetweenCoords(l.coords[1],l.coords[2],r,n,o,p,true)if s<20 then j=true;DrawMarker(2,l.coords[1],l.coords[2],l.coords[3],0,0,0,0,0,0,0.5,0.5,0.5,255,255,0,30,1,1,1,1)DrawText3D(l.coords[1],l.coords[2],l.coords[3]+0.6,l.title,1.0,4,100)if s<1.5 then if not e then e=true end;drawTxt("PRESSIONE ~b~E",4,0.50,0.95,0.36,255,255,255,240)if IsControlJustPressed(0,38)then if l.perm then if c.checkPerm(l.perm)then local t=c.checkCraft(l.item,l.itemqtd,l.giveitem,l.giveqtd)if t.error then if t.reason=="there is no free space in the inventory"then TriggerEvent("Notify","negado","Espaço insuficiente!")elseif t.reason=="does not have a necessary raw material"then TriggerEvent("Notify","negado","Não possui matéria prima!")end else TriggerEvent("cancelando",true)animApi.playAnim(false,{{"anim@amb@business@coc@coc_packing_hi@","full_cycle_v1_pressoperator"}},true)Citizen.Wait(10000)TriggerEvent("Notify","sucesso","Craftou x"..t.giveQtd.." "..t.giveItem.."!")animApi.stopAnim(false)TriggerEvent("cancelando",false)end else TriggerEvent("Notify","negado","Você não tem permissão!")end else local t=c.checkCraft(l.item,l.itemqtd,l.giveitem,l.giveqtd)if t.error then if t.reason=="there is no free space in the inventory"then TriggerEvent("Notify","negado","Espaço insuficiente!")elseif t.reason=="does not have a necessary raw material"then TriggerEvent("Notify","negado","Não possui matéria prima!")end else TriggerEvent("cancelando",true)animApi.playAnim(false,{{"anim@amb@business@coc@coc_packing_hi@","full_cycle_v1_pressoperator"}},true)Citizen.Wait(10000)TriggerEvent("Notify","sucesso","Craftou x"..t.giveQtd.." "..t.giveItem.."!")animApi.stopAnim(false)TriggerEvent("cancelando",false)end end end else e=false end end end;if j then i=1 else i=3000 end end end)function ToogleCraftWeaponMenu(u,v)SetNuiFocus(u,u)if u then SendNUIMessage({open=u,data=v})else SendNUIMessage({open=u})end end;Citizen.CreateThread(function()for k,l in pairs(d.peds)do local m=GetHashKey(k)RequestModel(m)while not HasModelLoaded(m)do Wait(0)end;_Npc=CreatePed(4,l[5],l[1],l[2],l[3]-0.999,l[4],true,true)FreezeEntityPosition(_Npc,true)SetEntityInvincible(_Npc,true)SetBlockingOfNonTemporaryEvents(_Npc,true)end end)RegisterNUICallback("closeMenu",function()ToogleCraftWeaponMenu(false)end)RegisterNUICallback("craftWeapon",function(w)local t=c.checkCraftWeapon(w._WeaponName,w._WeaponNameItem,w._Price)if not t.error then TriggerEvent("Notify","sucesso","Você fabricou uma "..w._WeaponName.."!")else TriggerEvent("Notify","negado","Você não tem aço suficiente!")end end)local x={"motoclub","antena"}local y=3000;local z=false;Citizen.CreateThread(function()while true do for k,l in pairs(d.craftWeapons)do if k==1 then z=false end;local m=GetPlayerPed(-1)local n,o,p=table.unpack(GetEntityCoords(m))local A,B,C=l.coords[1],l.coords[2],l.coords[3]local q,r=GetGroundZFor_3dCoord(A,B,C)local s=GetDistanceBetweenCoords(A,B,r,n,o,p,true)if s<20 then z=true;DrawMarker(2,A,B,C,0,0,0,0,0,0,0.5,0.5,0.5,255,255,0,30,1,1,1,1)DrawText3D(A,B,C+0.6,"FABRICAR ARMA",1.0,4,100)if s<1.5 then if IsControlJustPressed(0,38)then local D=false;for E=1,#x do if c.hasGroup(x[E])then D=true end end;if D then ToogleCraftWeaponMenu(true,l.data)else TriggerEvent("Notify","negado","Você não tem permissão!")end end end end end;if z then y=1 else y=3000 end;Citizen.Wait(y)end end)function newNotify(F,G,H,I)if G~=-1 then SetNotificationBackgroundColor(G)end;SetNotificationTextEntry(F)for J,K in ipairs(H)do AddTextComponentSubstringPlayerName(K)end;DrawNotification(false,false)if I then PlaySoundFrontend(-1,"Menu_Accept","Phone_SoundSet_Default",1)end end;function notify(L)newNotify("STRING",11,{""..L},true)end;RegisterCommand("rembag",function(M,N,O)local t=c.remBag()if not t then return TriggerEvent("Notify","negado","Você deve esvaziar seu inventario para 5kg's!")end;SetPedComponentVariation(GetPlayerPed(-1),7,0,0,2)end)function DrawText3D(n,o,p,P,Q,R,S)local T,A,B=World3dToScreen2d(n,o,p)local U,V,W=table.unpack(GetGameplayCamCoords())local X=GetDistanceBetweenCoords(U,V,W,n,o,p,1)local Y=1/X*Q;local Z=1/GetGameplayCamFov()*100;local Y=Y*Z;if T then SetTextScale(0.0*Y,1.1*Y)SetTextFont(R)SetTextProportional(1)SetTextColour(255,255,255,S)SetTextDropshadow(0,0,0,0,255)SetTextEdge(2,0,0,0,150)SetTextDropShadow()SetTextOutline()SetTextEntry("STRING")SetTextCentre(1)AddTextComponentString(P)DrawText(A,B)end end;function drawTxt(P,R,n,o,Y,_,a0,a1,a2)SetTextFont(R)SetTextScale(Y,Y)SetTextColour(_,a0,a1,a2)SetTextOutline()SetTextCentre(1)SetTextEntry("STRING")AddTextComponentString(P)DrawText(n,o)end