local a=module('_core','libs/Tunnel')local b=module('_core','libs/Proxy')local c=a.getInterface("hpp_houses")hpp_houses_client={}a.bindInterface("hpp_houses",hpp_houses_client)API=b.getInterface('API')cAPI=a.getInterface('cAPI')local d=module("hpp_houses","config/houses")Citizen.CreateThread(function()while true do Citizen.Wait(5*60*1000)collectgarbage("count")collectgarbage("collect")end end)local e=false;local f=""function ToogleHousesMenu(g,h,i,j,k)SetNuiFocus(g,g)if g then SendNUIMessage({open=g,house=h,coords00=i,_coords01=j,price=k})else SendNUIMessage({open=g})end end;RegisterNUICallback("enterHouse",function(l)local m=c.enterHouse(l)if m.error then TriggerEvent("Notify","negado","Você não possui esta casa!")else for n,o in pairs(d.houses)do if n==l then local p=GetPlayerPed(-1)SetEntityCoords(p,o._interior.x,o._interior.y,o._interior.z)e=true;f=n;ToogleHousesMenu(false)end end end end)Citizen.CreateThread(function()while true do Citizen.Wait(1)if e then local p=GetPlayerPed(-1)local q,r,s=table.unpack(GetEntityCoords(p))local t,u;local v;for n,o in pairs(d.houses)do if n==f then t,u=GetGroundZFor_3dCoord(o._interior.x,o._interior.y,o._interior.z)v=GetDistanceBetweenCoords(o._interior.x,o._interior.y,u,q,r,s,true)if v<10 then if v<1.5 then if IsControlJustPressed(0,38)then SetEntityCoords(p,o._entry.x,o._entry.y,o._entry.z)e=false;f=""end end end end end end end end)RegisterNUICallback("closeMenu",function()ToogleHousesMenu(false)end)function hpp_houses_client.isInHouse()return e end;RegisterNUICallback("buyHouse",function(l)for n,o in pairs(d.houses)do if n==l then local m=c.buyHouse(l,o._price,o._chest,o._chestSize)if m.error then if m.reason=="This house has already been sold"then TriggerEvent("Notify","negado","Essa casa já foi vendida!")ToogleHousesMenu(false)else if m.reason=="Don't have money"then TriggerEvent("Notify","negado","Você não possui dinheiro!")ToogleHousesMenu(false)end end else TriggerEvent("Notify","sucesso","Você comprou a casa!")ToogleHousesMenu(false)TriggerServerEvent("hoppe:update:houseblips")end end end end)RegisterNUICallback("sellHouse",function(w)local m=c.sellHouse(w.houseName,w.housePrice)if m.error then TriggerEvent("Notify","negado","Você não possui essa casa!")else TriggerEvent("Notify","sucesso","Você vendeu a casa e recebeu R$"..m.sellValue.."!")end end)local x={}Citizen.CreateThread(function()while true do Citizen.Wait(4000)for n,o in pairs(d.houses)do local p=GetPlayerPed(-1)local q,r,s=table.unpack(GetEntityCoords(p))local t,u=GetGroundZFor_3dCoord(o._entry.x,o._entry.y,o._entry.z)local v=GetDistanceBetweenCoords(o._entry.x,o._entry.y,u,q,r,s,true)if v<20 then if#x==0 or#x=="0"then table.insert(x,1,{o._entry.x,o._entry.y,o._entry.z,o._interior.x,o._interior.y,o._interior.z,o._price,n})else local y=false;for z,A in pairs(x)do if A[8]==n then y=true end end;if not y then table.insert(x,1,{o._entry.x,o._entry.y,o._entry.z,o._interior.x,o._interior.y,o._interior.z,o._price,n})end end end end end end)Citizen.CreateThread(function()while true do for n,o in pairs(x)do local p=GetPlayerPed(-1)local B,C,D=table.unpack(GetEntityCoords(p))local E,F,G=o[1],o[2],o[3]local v=GetDistanceBetweenCoords(B,C,D,E,F,G,true)if v<20 then end;if v<1.5 then if IsControlJustPressed(0,38)then ToogleHousesMenu(true,o[8],{["x"]=o[1],["y"]=o[2],["z"]=o[3]},{["x"]=o[4],["y"]=o[5],["z"]=o[6]},o[7])end end end;Citizen.Wait(1)end end)Citizen.CreateThread(function()while true do for n,o in pairs(x)do local p=GetPlayerPed(-1)local B,C,D=table.unpack(GetEntityCoords(p))local E,F,G=o[1],o[2],o[3]local v=GetDistanceBetweenCoords(B,C,D,E,F,G,true)if v>20 then table.remove(x,n)end end;Citizen.Wait(1)end end)local H={}Citizen.CreateThread(function()for n,o in pairs(d.houses)do if o._blipName then local I=AddBlipForCoord(o._entry.x,o._entry.y,o._entry.z)SetBlipSprite(I,o._blipSprite)local m=c.checkHouseSellStatus(n)if m.exist then SetBlipColour(I,1)BeginTextCommandSetBlipName("STRING")AddTextComponentString(o._blipName.."(VENDIDO)")else SetBlipColour(I,2)BeginTextCommandSetBlipName("STRING")AddTextComponentString(o._blipName)end;if not o._blipScale then SetBlipScale(I,0.7)else SetBlipScale(I,o._blipScale)end;SetBlipAsShortRange(I,true)EndTextCommandSetBlipName(I)table.insert(H,1,I)end end end)Citizen.CreateThread(function()for n,o in pairs(d.blips)do local I=AddBlipForCoord(o[1],o[2],o[3])SetBlipSprite(I,o[4])SetBlipColour(I,o[5])BeginTextCommandSetBlipName("STRING")AddTextComponentString(n)SetBlipScale(I,0.7)SetBlipAsShortRange(I,true)EndTextCommandSetBlipName(I)end end)RegisterNetEvent("hoppe:update:houseblips")AddEventHandler("hoppe:update:houseblips",function()for J=1,#H do RemoveBlip(H[J])end;for n,o in pairs(d.houses)do if o._blipName then local I=AddBlipForCoord(o._entry.x,o._entry.y,o._entry.z)SetBlipSprite(I,o._blipSprite)local m=c.checkHouseSellStatus(n)if m.exist then SetBlipColour(I,1)BeginTextCommandSetBlipName("STRING")AddTextComponentString(o._blipName.."(VENDIDO)")else SetBlipColour(I,2)BeginTextCommandSetBlipName("STRING")AddTextComponentString(o._blipName)end;if not o._blipScale then SetBlipScale(I,0.7)else SetBlipScale(I,o._blipScale)end;SetBlipAsShortRange(I,true)EndTextCommandSetBlipName(I)table.insert(H,1,I)end end end)function newNotify(K,L,M,N)if L~=-1 then SetNotificationBackgroundColor(L)end;SetNotificationTextEntry(K)for O,P in ipairs(M)do AddTextComponentSubstringPlayerName(P)end;DrawNotification(false,false)if N then PlaySoundFrontend(-1,"Menu_Accept","Phone_SoundSet_Default",1)end end;function notify(Q)newNotify("STRING",11,{""..Q},true)end