local a=module('_core','libs/Tunnel')local b=module('_core','libs/Proxy')local c=a.getInterface("hpp_criminalrecord")API=b.getInterface('API')cAPI=a.getInterface('cAPI')Citizen.CreateThread(function()while true do Citizen.Wait(5*60*1000)collectgarbage("count")collectgarbage("collect")end end)RegisterNUICallback("addBill",function(d)local e=d.val;local f=d.TargetCharId;print('charid',f)TriggerServerEvent("hoppe:add:bill:value",e,f)TriggerEvent("Notify","sucesso","Você multou o individuo!")end)local g=false;RegisterCommand("ficha",function(h,i,j)g=not g;if g then if i[1]then SetNuiFocus(true,true)if tonumber(i[1])==nil then return TriggerEvent("Notify","negado","ID inválido")end;local f=tonumber(i[1])TriggerServerEvent("hoppe:criminal:record:show:menu",f)end else SetNuiFocus(false,false)ToogleCriminalRecord(false)end end)RegisterCommand("addficha",function(h,i,j)if i[2]then if tonumber(i[1])==nil then return TriggerEvent("Notify","negado","ID inválido")end;local k=""for l=2,#i do k=""..k.." "..tostring(i[l])..""end;TriggerServerEvent("hoppe:add:criminal:record",i[1],k)end end)RegisterCommand("remficha",function(h,i,j)if i[1]then TriggerServerEvent("hoppe:rem:criminal:record",i[1])end end)RegisterNUICallback("closeMenu",function(d)g=not g;ToogleCriminalRecord(false)SetNuiFocus(false,false)end)function ToogleCriminalRecord(m,n,o,p)if m then SendNUIMessage({open=m,charinfo=n,criminal_records=o,billVal=p})else SendNUIMessage({open=m})end end;RegisterNetEvent("hoppe:criminal:record:show:menu")AddEventHandler("hoppe:criminal:record:show:menu",function(d)print(d.charinfo)print(d.criminal_records)ToogleCriminalRecord(true,d.charinfo,d.criminal_records,d.bill_value)end)function getNearestPlayer(q)local r={}local s=GetPlayerPed(-1)local t,u,v=table.unpack(GetEntityCoords(s))for w,x in pairs(GetActivePlayers())do local y=GetPlayerServerId(x)local z=GetPlayerPed(x)local A,B,C=table.unpack(GetEntityCoords(z))local D=GetDistanceBetweenCoords(A,B,C,t,u,v,true)if D<q then r[y]=D end end;local h=0;local E=q+0.01;for F,G in pairs(r)do if G>0.0 then if G<E then E=G;h=F end end end;return h end