local a=module('_core','libs/Tunnel')local b=module('_core','libs/Proxy')APICKF=b.getInterface('API')cAPI=a.getInterface('cAPI')hpp={}a.bindInterface("register_account",hpp)Citizen.CreateThread(function()while true do Citizen.Wait(5*60*1000)collectgarbage("count")collectgarbage("collect")end end)API_Database={}local c=exports['GHMattiMySQL']DBConnect={driver='ghmattimysql',host='127.0.0.1',database='ckf2',user='root',password=''}local d={}local e;local f={}local g={}local h={}local i=false;function API_Database.registerDBDriver(j,k,l,m)if not d[j]then d[j]={k,l,m}if j==DBConnect.driver then e=d[j]local n=k(DBConnect)if n then i=true;for o,p in pairs(f)do l(table.unpack(p,1,table.maxn(p)))end;for o,q in pairs(g)do async(function()q[2](m(table.unpack(q[1],1,table.maxn(q[1]))))end)end;f=nil;g=nil else error('ConexÃ£o com o banco de dados perdida.')end end else error('Banco de dados registrado.')end end;function API_Database.format(r)local s,t,u=string.match(r,'^([^%d]*%d)(%d*)(.-)$')return s..t:reverse():gsub('(%d%d%d)','%1.'):reverse()..u end;function API_Database.prepare(j,q)h[j]=true;if i then e[2](j,q)else table.insert(f,{j,q})end end;function API_Database.query(j,v,w)if not h[j]then error('query '..j.." doesn't exist.")end;if not w then w='query'end;if i then return e[3](j,v or{},w)else local x=async()table.insert(g,{{j,v or{},w},x})return x:wait()end end;function API_Database.execute(j,v)return API_Database.query(j,v,'execute')end;local y={}local function k(z)return c~=nil end;local function l(j,q)y[j]=q end;local function m(j,v,w)local q=y[j]local A={}A._=true;for B,C in pairs(v)do A['@'..B]=C end;local x=async()if w=='execute'then c:QueryAsync(q,A,function(D)x(D or 0)end)elseif w=='scalar'then c:QueryScalarAsync(q,A,function(E)x(E)end)else c:QueryResultAsync(q,A,function(F)x(F,#F)end)end;return x:wait()end;Citizen.CreateThread(function()c:Query('SELECT 1')API_Database.registerDBDriver('ghmattimysql',k,l,m)end)API_Database.prepare("CKF_/CheckExistAccount","SELECT * FROM launcher_accounts WHERE charid = @charid")API_Database.prepare("CKF_/RegisterAccount","INSERT INTO launcher_accounts (charid, username, password) VALUES (@charid, @username, @password)")function hpp.checkAccountRegister()local G=tonumber(source)local H=APICKF.getUserFromSource(G)if H then local I=H:getCharacter()if I then local J=I.id;local F=API_Database.query("CKF_/CheckExistAccount",{charid=I.id})if#F>0 then return true else return false end end end end;function hpp.registerAccount(K,L)local G=tonumber(source)local H=APICKF.getUserFromSource(G)if H then local I=H:getCharacter()if I then local J=I.id;API_Database.query("CKF_/RegisterAccount",{charid=J,username=K,password=L})end end end;function hpp.getCharId()local G=tonumber(source)local H=APICKF.getUserFromSource(G)if H then local I=H:getCharacter()if I then return I.id end end end